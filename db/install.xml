<?xml version="1.0" encoding="UTF-8" ?>
<XMLDB PATH="mod/eln/db" VERSION="20140311" COMMENT="OU wiki database tables."
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="../../../lib/xmldb/xmldb.xsd"
>
  <TABLES>
    <TABLE NAME="eln" COMMENT="Main table for OU wiki">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true" COMMENT="id of the table, please edit me"/>
        <FIELD NAME="course" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Course ID"/>
        <FIELD NAME="name" TYPE="char" LENGTH="255" NOTNULL="true" SEQUENCE="false" COMMENT="Name of wiki"/>
        <FIELD NAME="subwikis" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="0=single subwiki (no groups), 1=per-group subwikis, 2=per-user subwikis"/>
        <FIELD NAME="timeout" TYPE="int" LENGTH="9" NOTNULL="false" SEQUENCE="false" COMMENT="How long users are allowed to edit, in seconds, before it automatically saves their changes and ends the edit. Null = no timeout."/>
        <FIELD NAME="template" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="Null for no template, or set to a filename (name only, no path). File will be opened from mod_data/eln and used to initialise the content of all new subwikis."/>
        <FIELD NAME="intro" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="Optional non-editable text that displays above the edit field on the start page to describe the purpose of the wiki."/>
        <FIELD NAME="editbegin" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Date in seconds since epoch, or null. If set, the wiki is in read-only mode (i.e. even users who have mod/eln:edit cannot actually edit anything) until the specified date."/>
        <FIELD NAME="editend" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Date in seconds since epoch, or null. If set, the wiki is in read-only mode (i.e. even users who have mod/eln:edit cannot actually edit anything) from the specified date onwards."/>
        <FIELD NAME="completionpages" TYPE="int" LENGTH="9" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="If set, wiki should be marked complete once user creates this many new pages of their own."/>
        <FIELD NAME="completionedits" TYPE="int" LENGTH="9" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="If set, wiki should be marked complete once user makes this many edits to the wiki."/>
        <FIELD NAME="annotation" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="If set, wiki will use annotations."/>
        <FIELD NAME="introformat" TYPE="int" LENGTH="4" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="enablewordcount" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="1" SEQUENCE="false"/>
        <FIELD NAME="grade" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="allowimport" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Shows whether the link to import pages is displayed within the wiki activity."/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id" COMMENT="Primary key for eln"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="eln_ix_course" UNIQUE="false" FIELDS="course" COMMENT="So we can find all wikis for a course if we want."/>
      </INDEXES>
    </TABLE>
    <TABLE NAME="eln_subwikis" COMMENT="Contains a row for each subwiki. A subwiki is an independent collection of named pages. For example, when a wiki is set to group mode, each group has their own subwiki.">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true" COMMENT="id of the table, please edit me"/>
        <FIELD NAME="wikiid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Wiki that owns this subwiki"/>
        <FIELD NAME="groupid" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Null if not a group subwiki. References the group in mdl_groups that this subwiki is for."/>
        <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Null if not a user subwiki. References the user in mdl_user that this subwiki is for."/>
        <FIELD NAME="magic" TYPE="int" LENGTH="16" NOTNULL="true" SEQUENCE="false" COMMENT="Magic code used to provide a degree of access security for the RSS feeds, i.e. make it impossible to guess the URLs."/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id" COMMENT="primary key of the table, please edit me"/>
        <KEY NAME="eln_subwikis_fk_wikiid" TYPE="foreign" FIELDS="wikiid" REFTABLE="eln" REFFIELDS="id"/>
        <KEY NAME="eln_subwikis_fk_groupid" TYPE="foreign" FIELDS="groupid" REFTABLE="groups" REFFIELDS="id"/>
        <KEY NAME="eln_subwikis_fk_userid" TYPE="foreign" FIELDS="userid" REFTABLE="user" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="eln_subwikis_unique_group" UNIQUE="true" FIELDS="wikiid, groupid" COMMENT="Make sure only one group subwiki per wikiid"/>
        <INDEX NAME="eln_subwikis_unique_user" UNIQUE="true" FIELDS="wikiid, userid" COMMENT="Make sure only one user subwiki per wikiid"/>
      </INDEXES>
    </TABLE>
    <TABLE NAME="eln_pages" COMMENT="Single pages inside a subwiki. If a page has multiple versions, it still has only one entry in this table.">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true" COMMENT="id of the table, please edit me"/>
        <FIELD NAME="subwikiid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="The subwiki that owns this page."/>
        <FIELD NAME="title" TYPE="char" LENGTH="255" NOTNULL="true" SEQUENCE="false" COMMENT="Title for the page. All pages must have a title, but the start page for the wiki is set to empty string."/>
        <FIELD NAME="currentversionid" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Points to the most recent entry in eln_versions. This is the entry that will appear when viewing the page normally. May be null if there are no versions of the page yet."/>
        <FIELD NAME="locked" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="Allows the page to be locked. Introduced with the Annotations commenting system to allow page locking while editing annotations."/>
        <FIELD NAME="firstversionid" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Points to the entry in eln_versions that first related to this page. This is used for participation calculations to help with query load at that point."/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id" COMMENT="primary key of the table, please edit me"/>
        <KEY NAME="eln_pages_fk_currentversionid" TYPE="foreign" FIELDS="currentversionid" REFTABLE="eln_versions" REFFIELDS="id"/>
        <KEY NAME="subwikiid" TYPE="foreign" FIELDS="subwikiid" REFTABLE="eln_subwikis" REFFIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="subwikiid-title" UNIQUE="true" FIELDS="subwikiid, title"/>
      </INDEXES>
    </TABLE>
    <TABLE NAME="eln_versions" COMMENT="Each row here is a version of the content on a particular subwiki page. Whenever a change is saved, a new version is created.">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true" COMMENT="id of the table, please edit me"/>
        <FIELD NAME="pageid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Page that this is a version of."/>
        <FIELD NAME="xhtml" TYPE="text" NOTNULL="true" SEQUENCE="false" COMMENT="Contains actual XHTML content of the page. Should be well-formed XML (when placed inside a containing element)."/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Time (seconds since epoch) at which the version was created."/>
        <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="User who created this version. May be null if the version was created by the system, such as when the wiki is initialised from a template."/>
        <FIELD NAME="changestart" TYPE="int" LENGTH="9" NOTNULL="false" SEQUENCE="false" COMMENT="If a section was edited, set to the starting point (in bytes) of the section within the 'xhtml' field. If the whole page was edited, set to null."/>
        <FIELD NAME="changesize" TYPE="int" LENGTH="9" NOTNULL="false" SEQUENCE="false" COMMENT="If a section was edited, the new size of the section in bytes. Otherwise null."/>
        <FIELD NAME="changeprevsize" TYPE="int" LENGTH="9" NOTNULL="false" SEQUENCE="false" COMMENT="If a section was edited, the previous size of the section (before editing) in bytes. Otherwise null."/>
        <FIELD NAME="deletedat" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="timestamp when page version was deleted"/>
        <FIELD NAME="xhtmlformat" TYPE="int" LENGTH="4" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="wordcount" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0" SEQUENCE="false"/>
        <FIELD NAME="previousversionid" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Points to the entry in eln_versions of the previous version for the page. This is used for participation calculations to help with query load at that point."/>
        <FIELD NAME="importversionid" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id" COMMENT="primary key of the table, please edit me"/>
        <KEY NAME="eln_versions_fk_pageid" TYPE="foreign" FIELDS="pageid" REFTABLE="eln_pages" REFFIELDS="id"/>
        <KEY NAME="eln_versions_fk_userid" TYPE="foreign" FIELDS="userid" REFTABLE="user" REFFIELDS="id"/>
      </KEYS>
    </TABLE>
    <TABLE NAME="eln_links" COMMENT="Keeps record of all wiki-links (links within the wiki that were specified using square brackets, in the topageid or tomissingpage fields) and standard URL links or images (in the tourl field).">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true" COMMENT="id of the table, please edit me"/>
        <FIELD NAME="fromversionid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Version that contains this link."/>
        <FIELD NAME="topageid" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Target of the link. Must be specified unless the target doesn't exist yet."/>
        <FIELD NAME="tomissingpage" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="If link goes to a page that doesn't exist, includes name of missing page. Should be filled in (set this field to null, set topageid) once page is created."/>
        <FIELD NAME="tourl" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="When page links to a URL that is recorded here."/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id" COMMENT="primary key of the table, please edit me"/>
        <KEY NAME="eln_links_fk_fromversionid" TYPE="foreign" FIELDS="fromversionid" REFTABLE="eln_versions" REFFIELDS="id"/>
        <KEY NAME="eln_links_fk_topageid" TYPE="foreign" FIELDS="topageid" REFTABLE="eln_pages" REFFIELDS="id"/>
      </KEYS>
    </TABLE>
    <TABLE NAME="eln_locks" COMMENT="When people are editing a subwiki page or section, that information is stored in this table so that other people cannot edit the same thing at the same time.">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true" COMMENT="id of the table, please edit me"/>
        <FIELD NAME="pageid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Page being edited"/>
        <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Moodle user who holds this lock."/>
        <FIELD NAME="versionid" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Null if whole page is locked. If a section is locked, this is the version that they started off by editing."/>
        <FIELD NAME="sectionstart" TYPE="int" LENGTH="9" NOTNULL="false" SEQUENCE="false" COMMENT="Null if whole page is locked. If section is locked, this is the start position in bytes relative to the beginning of the 'xhtml' field in the specified version."/>
        <FIELD NAME="sectionsize" TYPE="int" LENGTH="9" NOTNULL="false" SEQUENCE="false" COMMENT="Null if whole page is locked. If section is locked, this is the size of the section being edited in bytes."/>
        <FIELD NAME="lockedat" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Time (seconds since epoch) at which lock was first seen."/>
        <FIELD NAME="expiresat" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Time (seconds since epoch) at which lock expires. Null if there is no expiry. (This is a hard lock that occurs about 1 minute after the user-visible timeout.)"/>
        <FIELD NAME="seenat" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Time (seconds since epoch) at which the user's client checked in to confirm they still hold the lock. Locks become invalid a certain time after this, in addition to the fixed expiry time."/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id" COMMENT="primary key of the table, please edit me"/>
        <KEY NAME="eln_locks_fk_pageid" TYPE="foreign" FIELDS="pageid" REFTABLE="eln_pages" REFFIELDS="id"/>
        <KEY NAME="eln_locks_fk_userid" TYPE="foreign" FIELDS="userid" REFTABLE="user" REFFIELDS="id"/>
        <KEY NAME="eln_locks_fk_versionid" TYPE="foreign" FIELDS="versionid" REFTABLE="eln_versions" REFFIELDS="id"/>
      </KEYS>
    </TABLE>
    <TABLE NAME="eln_sections" COMMENT="Stores reference to sections (marked by headings) within pages. Entries in this table are only added when sections are actually used to store something in the database. They may remain after the section itself has been deleted from the current page version.">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true" COMMENT="id of the table, please edit me"/>
        <FIELD NAME="pageid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of page that this section is for."/>
        <FIELD NAME="xhtmlid" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="This is the ID used in XHTML for the section, excluding prefix. For example if the heading is &lt;h2 id=&quot;eln_41_325&quot;&gt; then this value will be 41_325. When storing data for the main part of a page rather than a subsection, this should be set to null."/>
        <FIELD NAME="title" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="Title of section in plain text (no HTML), restricted to a reasonable length. The title is taken from the contents of the heading tag in HTML and is updated when the page is saved. ('Dead' sections retain their title in the database.)"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id" COMMENT="primary key of the table, please edit me"/>
        <KEY NAME="eln_sections_fk_pageid" TYPE="foreign" FIELDS="pageid" REFTABLE="eln_pages" REFFIELDS="id"/>
      </KEYS>
    </TABLE>
    <TABLE NAME="eln_annotations" COMMENT="Holds the inline comments for the commenting system called Annotations.">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="pageid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="used to get all all annotations on a page"/>
        <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="who created the annotation"/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Time the annotation was created or edited"/>
        <FIELD NAME="content" TYPE="text" NOTNULL="true" SEQUENCE="false" COMMENT="Annotation text, plain text not HTML"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
      </KEYS>
    </TABLE>
<!-- This is ousearch integration --> 
    <TABLE NAME="eln_words" COMMENT="Contains one entry for each known word." NEXT="eln_documents">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="9" NOTNULL="true" UNSIGNED="true" SEQUENCE="true" NEXT="word"/>
        <FIELD NAME="word" TYPE="char" LENGTH="32" NOTNULL="true" SEQUENCE="false" COMMENT="Word (upper-case)" PREVIOUS="id"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id" COMMENT="Unfortunately this key is required in MySQL for the sequence, bit of a waste of an index really..."/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="word" UNIQUE="true" FIELDS="word"/>
      </INDEXES>
    </TABLE>
    <TABLE NAME="eln_documents" COMMENT="Contains one entry for each known document (potential search result)." PREVIOUS="eln_words" NEXT="eln_occurrences">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="9" NOTNULL="true" UNSIGNED="false" SEQUENCE="true" NEXT="plugin"/>
        <FIELD NAME="plugin" TYPE="char" LENGTH="255" NOTNULL="true" SEQUENCE="false" COMMENT="Module or plug-in name e.g. mod/ouwiki, format/studycal" PREVIOUS="id" NEXT="courseid"/>

        <FIELD NAME="courseid" TYPE="int" LENGTH="10" NOTNULL="false" UNSIGNED="true" SEQUENCE="false" COMMENT="Course ID for documents within a course" PREVIOUS="plugin" NEXT="coursemoduleid"/>
        <FIELD NAME="coursemoduleid" TYPE="int" LENGTH="10" NOTNULL="false" UNSIGNED="true" SEQUENCE="false" COMMENT="Course-module ID for documents within a module" PREVIOUS="courseid" NEXT="groupid"/>
        <FIELD NAME="groupid" TYPE="int" LENGTH="10" NOTNULL="false" UNSIGNED="true" SEQUENCE="false" COMMENT="Group ID for documents within a group" PREVIOUS="coursemoduleid" NEXT="userid"/>
        <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="false" UNSIGNED="true" SEQUENCE="false" COMMENT="Group ID for documents within a group" PREVIOUS="groupid" NEXT="stringref"/>
        <FIELD NAME="stringref" TYPE="char" LENGTH="255" NOTNULL="false" SEQUENCE="false" COMMENT="Arbitrary string reference to identify document (null if not needed)" PREVIOUS="userid" NEXT="intref1"/>
        <FIELD NAME="intref1" TYPE="int" LENGTH="10" NOTNULL="false" UNSIGNED="true" SEQUENCE="false" COMMENT="Arbitrary int reference to identify document (null if not needed)" PREVIOUS="stringref" NEXT="intref2"/>
        <FIELD NAME="intref2" TYPE="int" LENGTH="10" NOTNULL="false" UNSIGNED="true" SEQUENCE="false" COMMENT="Arbitrary int reference to identify document (null if not needed)" PREVIOUS="intref1" NEXT="timemodified"/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" UNSIGNED="true" SEQUENCE="false" COMMENT="Time (seconds since epoch) at which document was modified" PREVIOUS="intref2" NEXT="timeexpires"/>
        <FIELD NAME="timeexpires" TYPE="int" LENGTH="10" NOTNULL="false" UNSIGNED="true" SEQUENCE="false" COMMENT="Time (seconds since epoch) at which document should be checked for changes, or null for no checks" PREVIOUS="timemodified"/>

      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id" NEXT="groupid"/>
        <KEY NAME="groupid" TYPE="foreign" FIELDS="groupid" REFTABLE="groups" REFFIELDS="id" PREVIOUS="primary" NEXT="userid"/>
        <KEY NAME="userid" TYPE="foreign" FIELDS="userid" REFTABLE="user" REFFIELDS="id" PREVIOUS="groupid"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="courseid_coursemoduleid" UNIQUE="false" FIELDS="courseid, coursemoduleid" COMMENT="To allow search via course or course and module. (OK to have shared index because it isn't possible to search coursemodule without knowing course.)" NEXT="plugin"/>
        <INDEX NAME="plugin" UNIQUE="false" FIELDS="plugin" COMMENT="So we can restrict search by plugin type." PREVIOUS="courseid_coursemoduleid"/>

      </INDEXES>
    </TABLE>
    <TABLE NAME="eln_occurrences" COMMENT="One entry for each unique word in each document. This is the really huge table." PREVIOUS="eln_documents">
      <FIELDS>
        <FIELD NAME="wordid" TYPE="int" LENGTH="9" NOTNULL="true" UNSIGNED="true" SEQUENCE="false" NEXT="documentid"/>
        <FIELD NAME="documentid" TYPE="int" LENGTH="9" NOTNULL="true" UNSIGNED="true" SEQUENCE="false" PREVIOUS="wordid" NEXT="score"/>
        <FIELD NAME="score" TYPE="int" LENGTH="9" NOTNULL="true" UNSIGNED="true" SEQUENCE="false" PREVIOUS="documentid"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="wordid, documentid" NEXT="documentid"/>
        <KEY NAME="documentid" TYPE="foreign" FIELDS="documentid" REFTABLE="eln_documents" REFFIELDS="id" PREVIOUS="primary"/>
      </KEYS>
    </TABLE>
  </TABLES>
</XMLDB>
